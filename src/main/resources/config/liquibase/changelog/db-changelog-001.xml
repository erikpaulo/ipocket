<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

	<changeSet id="1" author="Erik Lacerda">

		<createTable tableName="ACCOUNT">
			<column name="ID" type="integer" />
			<column name="NAME" type="varchar(255)" />
			<column name="TYPE" type="varchar(255)" />
			<column name="USER_ID" type="integer" />
			<column name="BRANCH" type="varchar(255)" />
			<column name="NUMBER" type="varchar(255)" />
			<column name="START_BALANCE" type="decimal" />
		</createTable>

		<addPrimaryKey columnNames="ID" tableName="ACCOUNT" />

		<addAutoIncrement catalogName="iPocket"
			columnDataType="integer" columnName="ID" incrementBy="1" schemaName="public"
			startWith="6" tableName="ACCOUNT" />

		<addForeignKeyConstraint baseColumnNames="USER_ID"
			baseTableName="ACCOUNT" constraintName="ACCOUNT_USER_ID_FK"
			referencedColumnNames="id" referencedTableName="user_account" />

		<createTable tableName="CATEGORY">
			<column name="ID" type="identity" />
			<column name="NAME" type="varchar(255)" />
			<column name="SUBCATEGORY_NAME" type="varchar(255)" />
			<column name="FIXED_COST" type="varchar(1)" />
			<column name="KIND" type="varchar(255)" />
			<column name="USER_ID" type="integer" />
		</createTable>

		<addAutoIncrement catalogName="iPocket"
			columnDataType="integer" columnName="ID" incrementBy="1" schemaName="public"
			startWith="16" tableName="CATEGORY" />

		<addForeignKeyConstraint baseColumnNames="USER_ID"
			baseTableName="CATEGORY" constraintName="CATEGORY_USER_ID_FK"
			referencedColumnNames="id" referencedTableName="user_account" />

		<addUniqueConstraint columnNames="USER_ID,NAME,SUBCATEGORY_NAME"
			tableName="CATEGORY" />

		<createTable tableName="ACCOUNT_ENTRY">
			<column name="ID" type="identity" />
			<column name="ACCOUNT_ID" type="integer" />
			<column name="DESC" type="varchar(255)" />
			<column name="CATEGORY_ID" type="integer" />
			<column name="DATE" type="date" />
			<column name="RECONCILED" type="varchar(1)" />
			<column name="AMOUNT" type="decimal" />
			<column name="USER_ID" type="integer" />
		</createTable>

		<addForeignKeyConstraint baseColumnNames="ACCOUNT_ID"
			baseTableName="ACCOUNT_ENTRY" constraintName="ACCOUNT_ENTRY_ACCOUNT_ID_FK"
			referencedColumnNames="ID" referencedTableName="ACCOUNT" />

		<addForeignKeyConstraint baseColumnNames="USER_ID"
			baseTableName="ACCOUNT_ENTRY" constraintName="ACCOUNT_ENTRY_USER_ID_FK"
			referencedColumnNames="id" referencedTableName="user_account" />
			
		<addForeignKeyConstraint baseColumnNames="CATEGORY_ID"
			baseTableName="ACCOUNT_ENTRY" constraintName="ACCOUNT_ENTRY_CATEGORY_ID_FK"
			referencedColumnNames="id" referencedTableName="CATEGORY" />

		<loadData encoding="UTF-8"
			file="config/liquibase/changelog/db-initialload_account.csv"
			separator=";" tableName="ACCOUNT" />

		<loadData encoding="UTF-8"
			file="config/liquibase/changelog/db-initialload_category.csv"
			separator=";" tableName="CATEGORY" />
			
		<loadData encoding="UTF-8"
			file="config/liquibase/changelog/db-initialload_account_entry.csv"
			separator=";" tableName="ACCOUNT_ENTRY" />



	</changeSet>

</databaseChangeLog>
